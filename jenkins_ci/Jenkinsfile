MOLECULE_TEST_DATE = ''

pipeline { 
    agent any 
    environment {
        MOLECULE_TEST_DATE = getDate()
    }
    stages {
        stage("Git checkout"){
            sshagent(['lereklerik']) {
                sh 'git clone -b jenkins git@github.com:lereklerik/ansible_test_roles.git .'
            }
        }
        stage("Structure of directories"){
            sh 'tree \$PWD'
        }
        stage("Run playbook"){
            if (secret_check){
                sh 'cd playbook/roles/elasticsearch-role'
                sh 'molecule test'
            }
            else{
                echo 'need more action'
            }
            
        }
        
    }
}